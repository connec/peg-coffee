{"value":{"type":"grammar","content":[{"type":"definition","name":"Grammar","content":{"type":"sequence","content":[{"type":"rule","name":"Rule","label":"head"},{"type":"sequence","content":[{"type":"rule","name":"NEWLINE"},{"type":"rule","name":"NEWLINE"},{"type":"rule","name":"Rule"}],"label":"tail","suffix":"*"}],"action":"type:    'grammar'\ncontent: [ head ].concat @extract tail, 2"},"comments":["Matches an entire grammar"]},{"type":"definition","name":"Rule","content":{"type":"sequence","content":[{"type":"choice","content":[{"type":"rule","name":"Comment"},{"type":"rule","name":"EMPTY_LINE"}],"label":"comments","suffix":"*"},{"type":"rule","name":"RuleIdentifier","label":"name"},{"type":"literal","content":":"},{"type":"rule","name":"INDENT"},{"type":"rule","name":"RuleContent","label":"def"}],"action":"type:     'rule'\nname:     name\ncomments: @compact comments\ncontent:  def"},"comments":["Matches a single rule in the grammar, including comments"]},{"type":"definition","name":"RuleContent","content":{"type":"sequence","content":[{"type":"rule","name":"RuleLine","label":"head"},{"type":"sequence","content":[{"type":"rule","name":"NEWLINE"},{"type":"literal","content":"/"},{"type":"rule","name":"SPACE"},{"type":"rule","name":"RuleLine"}],"label":"tail","suffix":"*"}],"action":"if tail.length is 0\n  head\nelse\n  type:    'choice'\n  content: [ head ].concat @extract tail, 3"},"comments":["Matches the content of a rule"]},{"type":"definition","name":"RuleLine","content":{"type":"sequence","content":[{"type":"rule","name":"Expression","label":"expr"},{"type":"sequence","content":[{"type":"rule","name":"SPACE","suffix":"+"},{"type":"rule","name":"Code"}],"label":"code","suffix":"?"}],"action":"if code\n  type:    'action'\n  content: expr\n  action:  code[1]\nelse\n  expr"},"comments":["Matches a single line in a rule"]},{"type":"definition","name":"Expression","content":{"type":"sequence","content":[{"type":"rule","name":"Sequence","label":"head"},{"type":"sequence","content":[{"type":"rule","name":"SPACE","suffix":"+"},{"type":"literal","content":"/"},{"type":"rule","name":"SPACE","suffix":"+"},{"type":"rule","name":"Sequence"}],"label":"tail","suffix":"*"}],"action":"if tail.length is 0\n  head\nelse\n  type:    'choice'\n  content: [ head ].concat @extract tail, 3"},"comments":["Matches a single expression"]},{"type":"definition","name":"Sequence","content":{"type":"sequence","content":[{"type":"rule","name":"Single","label":"head"},{"type":"sequence","content":[{"type":"rule","name":"SPACE","suffix":"+"},{"type":"rule","name":"Single"}],"label":"tail","suffix":"*"}],"action":"if tail.length is 0\n  head\nelse\n  type:    'sequence'\n  content: [ head ].concat @extract tail, 1"},"comments":["Matches a sequence of non-choice expressions"]},{"type":"definition","name":"Single","content":{"type":"sequence","content":[{"type":"sequence","content":[{"type":"rule","name":"LabelIdentifier"},{"type":"literal","content":":"}],"label":"label","suffix":"?"},{"type":"class","content":"&!","label":"prefix","suffix":"?"},{"type":"rule","name":"Primary","label":"primary"},{"type":"class","content":"?*+","label":"suffix","suffix":"?"}],"action":"primary.label  = label?[0]\nprimary.prefix = prefix\nprimary.suffix = suffix"},"comments":["Matches a single expression (including parenthesised sub-expressions)"]},{"type":"definition","name":"Primary","content":{"type":"choice","content":[{"type":"sequence","content":[{"type":"literal","content":"("},{"type":"rule","name":"SubExpression","label":"sub"},{"type":"literal","content":")"}],"action":"sub"},{"type":"rule","name":"RuleIdentifier","action":"type: 'rule'\nname: $$"},{"type":"rule","name":"String","action":"type:    'literal'\ncontent: $$"},{"type":"rule","name":"Class","action":"type:    'class'\ncontent: $$"},{"type":"literal","content":".","action":"type: 'wildcard'"},{"type":"literal","content":"~","action":"type: 'pass'"}]},"comments":["Matches a 'primary' expression"]},{"type":"definition","name":"SubExpression","content":{"type":"choice","content":[{"type":"sequence","content":[{"type":"rule","name":"SPACE"},{"type":"rule","name":"SubExpression","label":"sub"},{"type":"rule","name":"SPACE"}],"action":"sub"},{"type":"rule","name":"Expression"}]},"comments":["Matches the contents of a parenthesised sub expression"]},{"type":"definition","name":"Code","content":{"type":"choice","content":[{"type":"sequence","content":[{"type":"literal","content":"->"},{"type":"rule","name":"DOUBLE_INDENT"},{"type":"rule","name":"WHITESPACE","prefix":"!"},{"type":"wildcard"},{"type":"choice","content":[{"type":"sequence","content":[{"type":"rule","name":"NEWLINE","prefix":"!"},{"type":"wildcard"}]},{"type":"sequence","content":[{"type":"sequence","content":[{"type":"rule","name":"DOUBLE_INDENT","prefix":"!"},{"type":"rule","name":"WHITESPACE"}],"suffix":"*"},{"type":"rule","name":"DOUBLE_INDENT"}]}],"suffix":"*"}],"action":"@join($$[2..]).trim()"},{"type":"sequence","content":[{"type":"literal","content":"->"},{"type":"rule","name":"SPACE","suffix":"+"},{"type":"sequence","content":[{"type":"rule","name":"NEWLINE","prefix":"!"},{"type":"wildcard"}],"suffix":"+"}],"action":"@join($$[1..]).trim()"}]},"comments":["Matches code in one of two formats:","- block","- inline"]},{"type":"definition","name":"Comment","content":{"type":"sequence","content":[{"type":"literal","content":"#"},{"type":"sequence","content":[{"type":"rule","name":"NEWLINE","prefix":"!"},{"type":"wildcard"}],"label":"content","suffix":"*"},{"type":"rule","name":"NEWLINE"}],"action":"@join(content).trim()"},"comments":["Matches a comment"]},{"type":"definition","name":"RuleIdentifier","content":{"type":"sequence","content":[{"type":"class","content":"A-Z"},{"type":"class","content":"_a-zA-Z","suffix":"*"}],"action":"@join $$"},"comments":["Matches an identifier for a rule"]},{"type":"definition","name":"LabelIdentifier","content":{"type":"class","content":"_a-z","suffix":"+","action":"@join $$"},"comments":["Matches an identifier for a label"]},{"type":"definition","name":"String","content":{"type":"choice","content":[{"type":"sequence","content":[{"type":"literal","content":"'"},{"type":"sequence","content":[{"type":"choice","content":[{"type":"literal","content":"\\"},{"type":"literal","content":"'","prefix":"!"}]},{"type":"wildcard"}],"label":"content","suffix":"*"},{"type":"literal","content":"'"}],"action":"@unescape @join content"},{"type":"sequence","content":[{"type":"literal","content":"\""},{"type":"sequence","content":[{"type":"choice","content":[{"type":"literal","content":"\\"},{"type":"literal","content":"\"","prefix":"!"}]},{"type":"wildcard"}],"label":"content","suffix":"*"},{"type":"literal","content":"\""}],"action":"@unescape @join content"}]},"comments":["Matches a quoted string"]},{"type":"definition","name":"Class","content":{"type":"sequence","content":[{"type":"literal","content":"["},{"type":"sequence","content":[{"type":"choice","content":[{"type":"literal","content":"\\"},{"type":"literal","content":"]","prefix":"!"}]},{"type":"wildcard"}],"label":"content","suffix":"*"},{"type":"literal","content":"]"}],"action":"@unescape @join content"},"comments":["Matches a character class"]},{"type":"definition","name":"DOUBLE_INDENT","content":{"type":"sequence","content":[{"type":"rule","name":"INDENT"},{"type":"rule","name":"SPACE"},{"type":"rule","name":"SPACE"}]},"comments":["Matches a double index"]},{"type":"definition","name":"INDENT","content":{"type":"sequence","content":[{"type":"rule","name":"NEWLINE"},{"type":"rule","name":"SPACE"},{"type":"rule","name":"SPACE"}]},"comments":["Matches an indent"]},{"type":"definition","name":"EMPTY_LINE","content":{"type":"sequence","content":[{"type":"rule","name":"SPACE","suffix":"*"},{"type":"rule","name":"NEWLINE"}]},"comments":["Matches whitespace followed eventually by a newline"]},{"type":"definition","name":"WHITESPACE","content":{"type":"choice","content":[{"type":"rule","name":"NEWLINE"},{"type":"rule","name":"SPACE"}]},"comments":["Matches a single whitespace character"]},{"type":"definition","name":"NEWLINE","content":{"type":"choice","content":[{"type":"sequence","content":[{"type":"literal","content":"r"},{"type":"literal","content":"n","suffix":"?"}]},{"type":"literal","content":"n"}],"action":"'\\n'"},"comments":["Matches a single newline"]},{"type":"definition","name":"SPACE","content":{"type":"literal","content":" "},"comments":["Matches a single space"]}]}}
